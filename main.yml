---

- hosts: web_servers
  become: true
  
  vars_files:
    - vars_files.yml
      

  pre_tasks:
    - name: UPDATE APT CACHE
      apt:
        update_cache=true
        cache_valid_time=3600

  handlers:
    - name: restart solr
      service: name=solr state=restarted

  tasks:
    - name: INSTALL JAVA
      apt: name=openjdk-8-jdk state=present
          
    - name: DOWNLOAD SOLR
      get_url:
        #        url: "https://www.apache.org/dyn/closer.lua/solr/solr/9.9.0/solr-9.9.0.tgz"
        url: "https://dlcdn.apache.org/solr/solr/9.9.0/solr-9.9.0.tgz"  
          # dest: "{{ download_dir }}/solr-9.9.0.tgz"
        dest: /solr/solr-9.9.0.tgz
    - name: TEST 
    - name: EXPAND SOLR
      unarchive:
        #  src: "{{ download_dir }}/solr-9.9.0.tgz"
        # dest: "{{ download_dir }}/"
        src: /solr/solr-9.9.0.tgz
        dest: /solr/  
        remote_src: true
        creates: "{{ download_dir }}/solr-9.9.0/README.md"
    - name: "RUN SOLR INSTALLATION SCRIPT" 
      command: /solr/solr-9.9.0/bin/install_solr_service.sh /solr/solr-9.9.0.tgz -i /opt -d /var/solr -u solr -s solr  -p 8983
      creates: /opt/solr/bin/solr

    - name: ENSURE SOLR IS STARTED AND ENABLED
      service: 
        name=solr 
        state=started 
        enabled=yes

